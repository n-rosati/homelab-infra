apiVersion: helm.toolkit.fluxcd.io/v2
kind: HelmRelease
metadata:
    name: jdownloader2
    namespace: jdownloader2
spec:
    interval: 15m
    chart:
        spec:
            chart: jdownloader2
            version: 17.0.8
            sourceRef:
                kind: HelmRepository
                name: truecharts
                namespace: flux-system
    releaseName: jdownloader2
    values:
        TZ: America/Toronto
        addons:
            codeserver:
                enabled: false
            netshoot:
                enabled: false
            vpn:
                type: disabled
        configmap:
            jdownloader:
                data:
                    DISPLAY_HEIGHT: '{{ .Values.jdownloader.DISPLAY_HEIGHT }}'
                    DISPLAY_WIDTH: '{{ .Values.jdownloader.DISPLAY_WIDTH }}'
                    ENABLE_CJK_FONT: '{{ ternary "1" "0" .Values.jdownloader.ENABLE_CJK_FONT }}'
                    KEEP_APP_RUNNING: '{{ ternary "1" "0" .Values.jdownloader.KEEP_APP_RUNNING }}'
                    SECURE_CONNECTION: '{{ ternary "1" "0" .Values.jdownloader.SECURE_CONNECTION }}'
                enabled: true
        credentials:
            minio-creds:
                accessKey: 4oeR8vwUK0GIvsS8Hpzt
                bucket: truecharts-backup
                encrKey: 7Ly*EfR=
                name: minio-creds
                path: ""
                secretKey: wuUKWm8BLsRrTCJ3ihvCcHJFBB8UAQB2CU2KvLaB
                type: s3
                url: truecharts-backup.minio.nicholasrosati.xyz
#        ingress:
#            main:
#                enabled: true
#                hosts:
#                    - host: jdownloader.nicholasrosati.xyz
#                      paths:
#                        - path: /
#                          pathType: Prefix
#                ingressClassName: ""
#                integrations:
#                    certManager:
#                        certificateIssuer: maincert
#                        enabled: true
#                    homepage:
#                        description: ""
#                        enabled: true
#                        group: Downloaders
#                        icon: ""
#                        name: ""
#                        widget:
#                            custom:
#                                key: ""
#                            customkv:
#                                - key: username
#                                  value: nic.devil.101@gmail.com
#                                - key: password
#                                  value: iTKyY-pxa9Gt
#                            enabled: true
#                            type: jdownloader
#                    traefik:
#                        allowCors: false
#                        enabled: true
#                        entrypoints:
#                            - websecure
#                        middlewares:
#                            - name: ca-us
#                              namespace: ""
#                            - name: auth
#                              namespace: ""
        jdownloader:
            DISPLAY_HEIGHT: 768
            DISPLAY_WIDTH: 1280
            ENABLE_CJK_FONT: false
            KEEP_APP_RUNNING: true
            SECURE_CONNECTION: false
            gui: false
        persistence:
            config:
                enabled: true
                mountPath: /config
                readOnly: false
                storageClass: ""
                volsync:
                    - credentials: minio-creds
                      dest:
                        enabled: false
                      name: config
                      src:
                        enabled: true
                      type: restic
            output:
                autoPermissions:
                    enabled: false
                enabled: true
                mountPath: /output
                path: /mnt/DSU/Software/Downloads
                readOnly: false
                server: 192.168.2.8
                type: nfs
        release_name: jdownloader2
        resources:
            limits:
                memory: 1Gi
        securityContext:
            container:
                UMASK: "0022"
                readOnlyRootFilesystem: false
                runAsGroup: 0
                runAsNonRoot: false
                runAsUser: 0
            pod:
                fsGroupChangePolicy: OnRootMismatch
        service:
            main:
                enabled: true
                ports:
                    main:
                        port: 10054
                        targetPort: 5800
                type: ClusterIP
            myjd:
                enabled: true
                loadBalancerIP: ""
                ports:
                    myjd:
                        enabled: true
                        port: 3129
                        targetPort: 3129
                type: ClusterIP
            vnc:
                enabled: true
                loadBalancerIP: ""
                ports:
                    vnc:
                        enabled: true
                        port: 10056
                        targetPort: 5900
                type: LoadBalancer
        workload:
            main:
                podSpec:
                    containers:
                        main:
                            env:
                                VNC_PASSWORD: ""
                            envFrom:
                                - configMapRef:
                                    name: jdownloader
                            probes:
                                liveness:
                                    type: tcp
                                readiness:
                                    type: tcp
                                startup:
                                    type: tcp
                            securityContext:
                                capabilities:
                                    add:
                                        - NET_BIND_SERVICE
                                        - KILL
                replicas: 1
                type: Deployment
